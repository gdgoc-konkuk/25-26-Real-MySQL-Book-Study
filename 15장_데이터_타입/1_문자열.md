# 15.1 문자열(CHAR와 VARCHAR)

## 15.1.1 저장공간

- CHAR와 VARCHAR 의 공통점 => 문자열을 저장할 수 있는 데이터 타입

- CHAR와 VARCHAR 의 차이점 => 고정 길이인지 가변 길이인지
  - 고정 길이 : 실제 입력되는 칼럼값의 길이에 따라 사용하는 저장 공간의 크기가 변하지 않는다.
    - CHAR 타입은 저장 공간의 크기가 고정적이다.
  - 가변 길이 : 최대로 저장할 수 있는 값의 길이는 제한돼 있지만, 그 이하 크기의 값이 저장되면 그만큼 저장 공간이 줄어든다.
    - VARCHAR 타입은 저장된 값의 유효 크기가 얼마인지를 별도로 저장해둬야 해서 1~2 바이트의 저장 공간이 추가로 더 필요하다.

CHAR(1) 과 VARCHAR(1) 타입을 사용할 때, CHAR(1) 은 실제로 1 바이트만을 사용하지만, VARCHAR 타입은 유효 크기를 저장할 1 바이트의 공간이 추가로 필요해진다.
VARCHAR 타입의 길이가 255 바이트 이하라면 추가 공간을 1 바이트만 사용하고, 256 바이트 이상이라면 2 바이트를 사용한다.
이 때 2 바이트로 표현할 수 있는 최대 유효 크기는 65536 이기 때문에, VARCHAR 타입의 최대 길이는 65,536 바이트 이상으로 설정이 불가하다.

> [!IMPORTANT]
> 즉 고정된 크기의 문자열이 필요하다면 VARCHAR 대신 CHAR 를 사용하는 것이 좋다.
> 별도의 저장공간 1~2 바이트 외에도, 값이 자주 변경되는 경우 VARCHAR 를 사용하게 되면 레코드가 물리적으로 다른 위치로 이동하거나 분리될 수 있다. 이 경우 1~2 바이트의 공간 낭비 그 이상의 더 큰 공간이나 자원을 낭비하게 만들 수 있다.

## 15.1.2 저장 공간과 스키마 변경

앞서 설명한 것처럼 VARCHAR 의 경우, 유효 크기를 저장하기 위한 별도의 저장공간 1, 2 바이트가 필요하다고 했다.
그러다보니 길이를 저장하는 공간의 크기가 1바이트 -> 2바이트로 늘어나야하는 상황이 되면, 스키마를 변경하는 과정에서 단순한 COPY 알고리즘이 아닌 테이블의 레코드를 복사하는 방식으로 칼럼의 크기 변화를 처리하게된다.
이 과정은 성능 상에 불이익이 존재하기 때문에 만약 VARCHAR 타입의 길이가 크게 변경될 것으로 예상된다면 길이 저장 공간의 크기가 바뀌지 않도록 미리 조금 크게 설계하는 것이 좋다.

## 15.1.5 비교 방식

MySQL 서버에서 대부분 CHAR 타입과 VARCHAR 타입을 비교할 때에는 공백 문자를 뒤에 붙여서 두 문자열의 길이를 동일하게 만든 후 비교를 수행한다.

```sql
mysql> SELECT 'ABC'='ABC   ' AS is_equal;
+----------+
| is_equal |
+----------+
|        1 |  ==> TRUE
+----------+

mysql> SELECT 'ABC'='   ABC' AS is_equal;

+----------+
| is_equal |
+----------+
|        0 |  ==> FALSE
+----------+
```

위 예시를 보면 문자열 뒤에 붙어있는 공백은 있어도 없는 것처럼 비교하였고, 문자열의 앞쪽에 위치하는 공백 문자는 유효한 문자로 비교된다는 사실을 알 수 있다.

반면에 utf8mb4_0900_bin 이라는 콜레이션에서는 문자열 뒤의 공백이 비교 결과에 영향을 미치도록 바뀌었으니 사용할 경우 주의해야한다.

반면 예외적으로 LIKE 를 사용한 문자열 패턴 비교에서는 공백 문자가 유효 문자로 취급된다.

```sql
mysql> SELECT 'ABC  ' LIKE 'ABC' AS is_same_pattern;
+----------------+
| is_same_pattern |
+----------------+
|              0 |  ==> FALSE
+----------------+

mysql> SELECT '   ABC' LIKE 'ABC' AS is_same_pattern;
+----------------+
| is_same_pattern |
+----------------+
|              0 |  ==> FALSE
+----------------+

mysql> SELECT 'ABC  ' LIKE 'ABC%' AS is_same_pattern;
+----------------+
| is_same_pattern |
+----------------+
|              1 |  ==> TRUE
+----------------+
```

위의 예시를 보면 문자열의 앞뒤에 있는 공백이 모두 유효한 문자 값으로 인식됐음을 알 수 있다. 그리고 실제 이런 값을 비교하려면 세 번째 쿼리와 같이 검색어 앞 뒤로 와일드 카드('%') 문자를 사용해야 한다는 것을 알 수 있다.