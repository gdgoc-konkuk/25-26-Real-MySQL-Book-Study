# 5절. TEXT와 BLOB

MySQL에서 대용량 데이터를 저장할 때 사용하는 타입이 **TEXT**와 **BLOB**이다.

이 두 타입은 저장 방식이 유사하지만, **TEXT**는 문자열을 저장하여 문자 집합(Character Set)과 콜레이션(Collation)을 가지는 반면, **BLOB**는 이진 데이터를 저장하며 별도의 문자 집합을 가지지 않는다는 것이 유일한 차이점이다.

### TEXT 및 BLOB 타입의 분류

TEXT와 BLOB 타입 모두 저장할 수 있는 최대 길이에 따라 다시 4가지 타입으로 분류된다.

| 데이터 타입 | 필요한 저장 공간 (L: 데이터 바이트 수) | 저장 가능한 최대 바이트 수 |
| --- | --- | --- |
| **TINYTEXT, TINYBLOB** | L + 1바이트 | 28−1 (255) |
| **TEXT, BLOB** | L + 2바이트 | 216−1 (65,535) |
| **MEDIUMTEXT, MEDIUMBLOB** | L + 3바이트 | 224−1 (16,777,215) |
| **LONGTEXT, LONGBLOB** | L + 4바이트 | 232−1 (4,294,967,295) |

---

### 저장 위치 결정 (Off-Page Storage)

- MySQL 서버는 레코드 전체 길이가 **8126바이트**를 넘어설 경우, 큰 BLOB/TEXT 컬럼의 값을 잘라 **외부 페이지로 옮겨 저장**하려고 한다.
- 레코드의 **PRIMARY KEY 페이지**에는 BLOB/TEXT 데이터 전체 대신 **BLOB 프리픽스(Prefix)** 또는 BLOB 참조값(Reference)만 저장된다.

| `fd_blob`의 길이 | `fd_text`의 길이 | `fd_blob`의 저장 위치 | `fd_text`의 저장 위치 |
| --- | --- | --- | --- |
| 3000 | 3000 | 프라이머리 키 페이지 | 프라이머리 키 페이지 |
| 3000 | 10000 | 프라이머리 키 페이지 | **외부 페이지** |
| 10000 | 10000 | **외부 페이지** | **외부 페이지** |

### TEXT/BLOB 사용 시 고려사항

### 인덱스 제약

- BLOB 또는 TEXT 타입 컬럼에 인덱스를 생성하려면 **최대 길이 제한**이 있다.
    - **InnoDB (DYNAMIC/COMPRESSED):** 인덱스 최대 길이는 **3072바이트**이다.
    - **UTF8MB4 문자열:** 인덱스 생성 시 최대 **768자**까지만 가능하다. (3072바이트 / 4바이트)
    - **Latin1 문자열:** 최대 **3072자**까지 가능하다.
- **성능 저하:** BLOB/TEXT 컬럼을 참조하는 쿼리는 그렇지 않은 쿼리보다 성능이 떨어질 수 있다. 특히 BLOB 프리픽스를 활용하지 않는 쿼리에서 더 두드러진다.

### 임시 테이블 (TempTable)

- MySQL 8.0부터 `MEMORY` 스토리지 엔진은 **TEXT나 BLOB 타입**을 지원하지 않는다.
- TEXT/BLOB을 포함하는 쿼리 실행 시 임시 테이블이 필요하면 `internal_tmp_mem_storage_engine` 변수가 `TempTable`로 설정되어야 메모리(TempTable 엔진)를 사용하여 빠르게 처리할 수 있다.

### VARCHAR 대안

- TEXT/BLOB은 값의 길이가 예측할 수 없을 때 사용해야 한다. 하지만 MySQL에서는 레코드 전체 길이가 **64KB**를 넘지 않는 한, **VARCHAR나 VARBINARY**의 길이도 제한 없이 지정할 수 있다.